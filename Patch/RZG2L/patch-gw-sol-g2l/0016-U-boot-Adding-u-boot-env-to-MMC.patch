Subject: [PATCH 16/24] U-boot: Adding u-boot env to MMC

- u-boot env is enabled on mmc0 at offset 0x110000

---
 .../u-boot/0001-Added-u-boot-env-to-MMC.patch | 44 +++++++++++++++++++
 .../recipes-bsp/u-boot/u-boot/fw_env.config   |  2 +-
 .../u-boot/u-boot_2021.10.bbappend            |  1 +
 3 files changed, 46 insertions(+), 1 deletion(-)
 create mode 100644 meta-renesas/meta-rzg2l/recipes-bsp/u-boot/u-boot/0001-Added-u-boot-env-to-MMC.patch

diff --git a/meta-renesas/meta-rzg2l/recipes-bsp/u-boot/u-boot/0001-Added-u-boot-env-to-MMC.patch b/meta-renesas/meta-rzg2l/recipes-bsp/u-boot/u-boot/0001-Added-u-boot-env-to-MMC.patch
new file mode 100644
index 00000000..88ce6d1b
--- /dev/null
+++ b/meta-renesas/meta-rzg2l/recipes-bsp/u-boot/u-boot/0001-Added-u-boot-env-to-MMC.patch
@@ -0,0 +1,44 @@
+From 7d88fa82f9da0709b9bc416e5db3d51ca7b838c7 Mon Sep 17 00:00:00 2001
+From: Alexandre Delarge <alexandre.delarge.vz@renesas.com>
+Date: Mon, 21 Jul 2025 22:26:34 +0530
+Subject: [PATCH] Added u-boot env to MMC
+
+- u-boot env is enabled on mmc0 at offset 0x110000
+
+Signed-off-by: Alexandre Delarge <alexandre.delarge.vz@renesas.com>
+---
+ configs/smarc-rzg2l_defconfig | 4 ++--
+ env/mmc.c                     | 2 +-
+ 2 files changed, 3 insertions(+), 3 deletions(-)
+
+diff --git a/configs/smarc-rzg2l_defconfig b/configs/smarc-rzg2l_defconfig
+index d50c5851ba..14273e4a8a 100644
+--- a/configs/smarc-rzg2l_defconfig
++++ b/configs/smarc-rzg2l_defconfig
+@@ -2,8 +2,8 @@ CONFIG_ARM=y
+ CONFIG_ARCH_CPU_INIT=y
+ CONFIG_ARCH_RMOBILE=y
+ CONFIG_SYS_TEXT_BASE=0x50000000
+-CONFIG_ENV_SIZE=0x10000
+-CONFIG_ENV_OFFSET=0xF0000
++CONFIG_ENV_SIZE=0x19000
++CONFIG_ENV_OFFSET=0x110000
+ CONFIG_DM_GPIO=y
+ CONFIG_RCAR_GEN3=y
+ CONFIG_R9A07G044L=y
+diff --git a/env/mmc.c b/env/mmc.c
+index 09e94f0bd3..6fa271c377 100644
+--- a/env/mmc.c
++++ b/env/mmc.c
+@@ -215,7 +215,7 @@ static int env_mmc_save(void)
+ 		goto fini;
+ 	}
+
+-	printf("Writing to %sMMC(%d)... ", copy ? "redundant " : "", dev);
++	printf("Writing to %sMMC(%d) at offset 0x%x... ", copy ? "redundant " : "", dev, offset);
+ 	if (write_env(mmc, CONFIG_ENV_SIZE, offset, (u_char *)env_new)) {
+ 		puts("failed\n");
+ 		ret = 1;
+--
+2.25.1
+
diff --git a/meta-renesas/meta-rzg2l/recipes-bsp/u-boot/u-boot/fw_env.config b/meta-renesas/meta-rzg2l/recipes-bsp/u-boot/u-boot/fw_env.config
index e34943cd..93768904 100644
--- a/meta-renesas/meta-rzg2l/recipes-bsp/u-boot/u-boot/fw_env.config
+++ b/meta-renesas/meta-rzg2l/recipes-bsp/u-boot/u-boot/fw_env.config
@@ -38,4 +38,4 @@
 #/dev/ubi0:env-redund	0x0		0x1f000		0x1f000

 # mmc0 offset for u-boot env
-/dev/mmcblk0		0x110000	0x78000
+/dev/mmcblk0		0x110000	0x19000
diff --git a/meta-renesas/meta-rzg2l/recipes-bsp/u-boot/u-boot_2021.10.bbappend b/meta-renesas/meta-rzg2l/recipes-bsp/u-boot/u-boot_2021.10.bbappend
index 897ac1bc..4bacb66d 100644
--- a/meta-renesas/meta-rzg2l/recipes-bsp/u-boot/u-boot_2021.10.bbappend
+++ b/meta-renesas/meta-rzg2l/recipes-bsp/u-boot/u-boot_2021.10.bbappend
@@ -5,6 +5,7 @@ SRC_URI_append = " \
 	file://0001-Enable-runtime-env-configuration.patch \
 	file://fw_env.config \
 	file://0001-Adding-aws-greengrass-lambda-function-bootargs.patch \
+	file://0001-Added-u-boot-env-to-MMC.patch \
 "

 UBOOT_SREC_SUFFIX = "srec"
--
2.25.1
